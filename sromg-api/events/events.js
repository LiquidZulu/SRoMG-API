const EventEmitter=require('events');const{JSDOM}=require('jsdom');const got=require('got');const FLAGS=require('../const/FLAGS.js');const Author=require('../classes/author.js');const Comic=require('../classes/comic.js');function readPage(link,_cb){const prom=got(link);if(_cb){prom.then(_cb)}else{return prom}}class event_handler extends EventEmitter{init(ARGS){if(!ARGS){return}try{switch(!!(ARGS.FLAGS&FLAGS.META_PARSER_PARSE_AUTHOR)){case true:{{this.initAuth(ARGS).then(r=>{switch(r){case true:{{this.emit("AUTH_INIT_SUCCESS",this.author);if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)&&!(ARGS.FLAGS&FLAGS.META_PARSER_NO_EVENT_LOGS)){console.log(`NEW EVENT: AUTH_INIT_SUCCESS`)}};break}case false:{{this.emit("AUTH_INIT_FAILURE",this.err);if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)&&!(ARGS.FLAGS&FLAGS.META_PARSER_NO_EVENT_LOGS)){console.log(`NEW EVENT: AUTH_INIT_FAILURE`)}};break}}})};break}case false:{{this.initComic(ARGS).then(r=>{switch(r){case true:{{this.emit("COMIC_INIT_SUCCESS",this.comic);if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)&&!(ARGS.FLAGS&FLAGS.META_PARSER_NO_EVENT_LOGS)){console.log(`NEW EVENT: COMIC_INIT_SUCCESS`)}};break}case false:{{this.emit("COMIC_INIT_FAILURE",this.err);if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)&&!(ARGS.FLAGS&FLAGS.META_PARSER_NO_EVENT_LOGS)){console.log(`NEW EVENT: COMIC_INIT_FAILURE`)}};break}}})};break}}}catch(e){try{if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)){throw(`SRoMG_META failed to init in constructor for following reason: ${ e }`)}}catch(e){console.log(e);this.err=e}}}async initAuth(ARGS){try{let res=await readPage(`http://www.mezzacotta.net/garfield/author.php?author=${ARGS.n }`);const{document}=(new JSDOM(res.body)).window;this.author=new Author(document);return true}catch(e){try{if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)){throw(`SRoMG_META.event_handler failed to complete initAuth() for following reason: ${ e }`)}}catch(e){console.log(e);this.err=e;return false}}}async initComic(ARGS){try{let res=await readPage(`http://www.mezzacotta.net/garfield/?comic=${ARGS.n }`);const{document}=(new JSDOM(res.body)).window;this.comic=new Comic(document);return true}catch(e){try{if(!(ARGS.FLAGS&FLAGS.META_PARSER_NO_LOGS)){throw(`SRoMG_META.event_handler failed to complete initComic() for following reason: ${ e }`)}}catch(e){console.log(e);this.err=e;return false}}}async getAuthor(n){let res=await readPage(`http://www.mezzacotta.net/garfield/author.php?author=${ n }`);const{document}=(new JSDOM(res.body)).window;return new Author(document)}async getComic(n){let res=await readPage(`http://www.mezzacotta.net/garfield/?comic=${ n }`);const{document}=(new JSDOM(res.body)).window;return new Comic(document)}};module.exports=event_handler;